<div class="chat-page">
  <div class="bg-orb orb-one"></div>
  <div class="bg-orb orb-two"></div>
  <div class="bg-lines"></div>

  <section class="chat-shell animate-fade-in-up">
    <header class="chat-header">
      <div class="title-stack">
        <div class="badge-row">
          <span class="pill live">Live</span>
          <span class="pill glow">Gemini Pulse</span>
        </div>
        <h2>Chat like it's 2025</h2>
        <p>Vibe with Gemini for code help, launch ideas, and lightning-fast feedback.</p>
      </div>
      <div class="header-actions">
        <button nz-button nzType="default" nzShape="round" (click)="clearChat()" [disabled]="loading">
          <span nz-icon nzType="delete"></span>
          Clear thread
        </button>
        <button
          nz-button
          nzType="primary"
          nzShape="round"
          (click)="usePrompt('Summarize the last message with next steps')"
          [disabled]="loading || !messages.length"
        >
          <span nz-icon nzType="thunderbolt"></span>
          Spark reply
        </button>
      </div>
    </header>

    <div class="prompt-row">
      <button
        *ngFor="let prompt of quickPrompts"
        class="prompt-chip"
        type="button"
        (click)="usePrompt(prompt)"
        [disabled]="loading"
      >
        {{ prompt }}
      </button>
    </div>

    <div class="chat-window" #scrollContainer>
      <div *ngIf="loading && messages.length === 0" class="skeleton-stack">
        <div class="skeleton bubble"></div>
        <div class="skeleton bubble short"></div>
      </div>
      <div *ngIf="messages.length === 0 && !loading" class="empty-state">
        <div class="empty-icon">
          <span class="dot-icon">AI</span>
        </div>
        <h3>Drop your first message</h3>
        <p>Ask for UI inspo, debugging help, or fresh microcopy—Gemini ships ideas instantly.</p>
      </div>

      <div
        *ngFor="let msg of messages"
        class="message-row"
        [class.user-row]="msg.sender === 'user'"
      >
        <div class="avatar">
          <nz-avatar
            [nzIcon]="msg.sender === 'user' ? 'user' : 'thunderbolt'"
            [nzSrc]="
              msg.sender === 'ai'
                ? 'https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ff6292a690345.svg'
                : undefined
            "
            [style.background-color]="msg.sender === 'user' ? '#0f172a' : '#0b1535'"
            [style.color]="msg.sender === 'user' ? '#fff' : '#7dd3fc'"
          ></nz-avatar>
        </div>
        <div class="message-bubble" [class.user-bubble]="msg.sender === 'user'">
          <div class="message-meta">
            <span class="sender">{{ msg.sender === 'user' ? 'You' : 'Gemini' }}</span>
            <span class="timestamp">{{ msg.timestamp | date : 'shortTime' }}</span>
          </div>
          <div class="content" [innerHTML]="formatMessage(msg.content)"></div>
        </div>
      </div>

      <div *ngIf="loading" class="message-row ai-row">
        <div class="avatar">
          <nz-avatar
            nzSrc="https://www.gstatic.com/lamda/images/gemini_sparkle_v002_d4735304ff6292a690345.svg"
          ></nz-avatar>
        </div>
        <div class="message-bubble loading-bubble">
          <nz-spin nzSimple [nzSize]="'small'"></nz-spin>
          <span class="typing">Typing</span>
        </div>
      </div>
    </div>

    <div class="composer">
      <div class="input-shell">
        <textarea
          nz-input
          class="chat-input"
          rows="3"
          [(ngModel)]="inputValue"
          (keydown)="handleKeyDown($event)"
          placeholder="Ask for code help, brand vibes, or product ideas…"
          [disabled]="loading"
        ></textarea>
        <div class="composer-actions">
          <button
            nz-button
            nzType="primary"
            nzShape="round"
            class="send-btn"
            (click)="sendMessage()"
            [nzLoading]="loading"
          >
            <span nz-icon nzType="send"></span>
            Send
          </button>
        </div>
      </div>
      <div class="composer-meta">
        <span>Enter to send · Shift + Enter for a new line</span>
        <span class="status-dot" [class.live]="!loading">Realtime Gemini</span>
      </div>
    </div>
  </section>
</div>
